<!DOCTYPE html PUBLIC "Early Sudoku test
	for online page">
	
<html>
	<head> <title>Sudoku Max</title> <script type="text/javascript"> 
	/*
Here's the smartlink.js file from DHTML Utopia book

I'll annotate as I go
we have the following key elements
function addEvent(elm, evType, fn, useCapture {}
function ascendDOM(e, target) {}

function addListeners(e) {}

addEvent(window, 'load', addListeners, false);

nb how addEvent call is the last item
called on the window when it 'loads' 
and adding the listeners 

*/
//########
//Early setup of variables
var touchNum = 1;
var highlightNum = 0;
var doodleSwitch = false;
var isSplit = false;
var turnedPink = [99];
var allFilled = false;
var puzzleID = "000000900";
var puzzleStarted = false;
var puzzleCookie = "";

//We may eventually get the puzzle string in a better way
//generated by another page
//This will only load on a first read
//afterwards if there is a cookie that matches the puzzleID
//it will load the numbers from that
var thePuzzle = "000000900";
var thePuzzle = thePuzzle + "000180004";
var thePuzzle = thePuzzle + "803040000";
var thePuzzle = thePuzzle + "700000000";
var thePuzzle = thePuzzle + "200000001";
var thePuzzle = thePuzzle + "000000006";
var thePuzzle = thePuzzle + "000010308";
var thePuzzle = thePuzzle + "400073000";
var thePuzzle = thePuzzle + "009000000";

if (thePuzzle.length != 81) {alert(thePuzzle.length);}

//gridarray couldn't be easier

var aGridArray = [[1,2,3,4,5,6,7,8,9], [10,11,12,13,14,15,16,17,18],
[19,20,21,22,23,24,25,26,27], [28,29,30,31,32,33,34,35,36],
[37,38,39,40,41,42,43,44,45], [46,47,48,49,50,51,52,53,54],
[55,56,57,58,59,60,61,62,63], [64,65,66,67,68,69,70,71,72],
[73,74,75,76,77,78,79,80,81], [1,10,19,28,37,46,55,64,73],
[2,11,20,29,38,47,56,65,74], [3,12,21,30,39,48,57,66,75],
[4,13,22,31,40,49,58,67,76], [5,14,23,32,41,50,59,68,77],
[6,15,24,33,42,51,60,69,78], [7,16,25,34,43,52,61,70,79],
[8,17,26,35,44,53,62,71,80], [9,18,27,36,45,54,63,72,81],
[1,2,3,10,11,12,19,20,21], [4,5,6,13,14,15,22,23,24],
[7,8,9,16,17,18,25,26,27], [28,29,30,37,38,39,46,47,48],
[31,32,33,40,41,42,49,50,51], [34,35,36,43,44,45,52,53,54],
[55,56,57,64,65,66,73,74,75], [58,59,60,67,68,69,76,77,78],
[61,62,63,70,71,72,79,80,81]];

var aGrid3D = [[1,4,7,28,31,34,55,58,61],[2, 5, 8, 29, 32, 35, 56, 59,
62],[3, 6, 9, 30, 33, 36, 57, 60,
63],[10,13,16,37,40,43,64,67,70],[11,14, 17, 38, 41, 44, 65,68,71], [12,
15, 18,39, 42, 45, 66,69,72],[19,22,25,46,49,52,73,76,79],[20,23, 26,
47, 50, 53, 74,77,80], [21, 24, 27,48, 51, 54, 75,78,81]];

var aGridSpiral =
[1,2,3,4,5,6,7,8,9,18,27,36,45,54,63,72,81,80,79,78,77,76,75,74,73,64,55
,46,37,28,19,10,11,12,13,14,15,16,17,26,35,44,53,62,71,70,69,68,67,66,65
,56,47,38,29,20,21,22,23,24,25,34,43,52,61,60,59,58,57,48,39,30,31,32,33,42,51,50,49,40,41];

var newNineSq = "<table id='tableToGo' width=100% height=100%><tr align='center'><td class='tiny2'>1</td><td class='tiny2'>2</td><td class='tiny2'>3</td></tr>"
 	newNineSq = newNineSq + "<tr align='center'><td class='tiny2'>4</td><td class='tiny2'>5</td><td class='tiny2'>6</td></tr>"
 	newNineSq = newNineSq + "<tr align='center'><td class='tiny2'>7</td><td class='tiny2'>8</td><td class='tiny2'>9</td></tr></table>"

//

//Here's myBigArray constructor
//NB The second lot of 81 numbers (excluding 0 value) can be
//1 or 2, 2 indicating that it's a puzzle number
//in black and not to be changed.

var smallArray = new Array(82);
for (var i11 = 0; i11 < 82; i11++) {
	smallArray[i11] = [0,0];
    }

var myBigArray = smallArray;


//Here's a function that turns integers, eg 511 into
//string arrays to tell which of numbers 1 to 9
//are chosen, eg 1,2,3,4,5,6,7,8,9
function BintoString(bigInt) {
    var aRetString = new Array();
    var iBinny = bigInt;
    
    for (var i10 = 0; i10 < 9; i10++) {
        
        if (iBinny%2 == 1) {
            aRetString.push(i10 + 1);
        }
        else {
            aRetString.push(" ");
        }
        iBinny = iBinny >> 1
    }
    return aRetString
}
//Turning entered singletons into eg 1 2 3 8 16 etc
function makeIntBin(bigInt) {
    var Reto = 0;
    if (bigInt != 0) {
        Reto = 1 << (bigInt - 1);
    }
    
    return Reto;
}

function BintoInt(iBinny) {
    var aRetInt = 0;
    var iBinny2 = iBinny;
    
    for (i10 = 0; i10 < 9; i10++) {
        if (iBinny2%2 == 1) {
            aRetInt = i10 + 1;
        }
        iBinny2 = iBinny2 >> 1;
    }
    
    
    return aRetInt
}




//#####

function addEvent(elm, evType, fn, useCapture) {
 //By Andrew Scott
 //ie if the browsers DOM model has an addEventListener model
 if (elm.addEventListener) {
 	elm.addEventListener(evType, fn, useCapture); 
 	return true;
 } else if (elm.attachEvent) {
 
 //if the model uses attachEvent instead 
 	var r = elm.attachEvent('on' + evType, fn);
 	return r;
 } else {
 	
 	//another option
 	elm['on' + evType] = fn;
 }
 
 //Return value will either have directly attached the event, 
 //returning true
 //or returned a variable (what i don't know) with onClick, action
 // returned an action onClick = action
 
 
 //It's first call will have told the window's onLoad event to addListeners
 }
 
 
 //climb up the tree to the supplied tag
 //used in negotiating table to highlight rows and columns
 function ascendDOM(e, target) {
 
 	while (e.nodeName.toLowerCase() != target && e.nodeName.toLowerCase() != 'html') {
 	e = e.parentNode;
 	}
 	
 	return (e.nodeName.toLowerCase() == 'html') ? null : e;
 	//ternary operator, returns null if you get to html
 }
 	
 	
 /*	//this will run on load if addEvent is called with window, 'load' addListeners
 function addListeners() {
 	//if(!document.getElementsByTagName) return; 
 	
 	//var all_cells = document.getElementsByTagName('td'); 
 	
 	//So I can call the tds by a single class name
 	//or I c
 	
 	
 	if(!document.getElementsByClassName) return; 
 	//alert("we tried");
 	var all_cells = document.getElementsByClassName("listener")
 	
 	
 	for (var i = 0; i < all_cells.length; i++) {
 	
 		addEvent(all_cells[i], 'click', alert_me, false);
 		
 		//just create a function hi_cell to see what happens
 		
 		}
 }
 */
 
 function addListeners() {
 
 		i = 1;
 		
 	while (i < 82) {
 		
 		//this is a way to add using id
 		//you could then add in reverse
 		each_cell = document.getElementById(i.toString()); 
 			
 			
 			
 		addEvent(each_cell, 'click', cell_tap, false);
 		i++;
 		
 	}
 	//now ad listeners for the touch numbers
 	i = 101;
 	while (i < 110) {
 		
 		//this is a way to add using id
 		//you could then add in reverse
 		each_cell = document.getElementById(i.toString()); 
 			
 			
 			
 		addEvent(each_cell, 'click', num_tap, false);
 		
 		i++;
 		
 	}
 	
 	a_cell = document.getElementById("doodle");
 	addEvent(a_cell, 'click', doodle_tap, false);
 	
	
	
	//this flag puzzleStarted
	puzzleCookie = checkCookie();
	
	//we need a puzzle load here
	loadPuzzle();
 	//load Puzzle choices
 	if (puzzleStarted == true) {
 		loadPuzzleChoices(); 
 	}
 	
 }
 
 function doodle_tap(e) {
 	
 	var el = window.event.srcElement;
 	doodleSwitch = doodleSwitch == false ? true : false;
 	el.innerHTML = doodleSwitch == true ? "Doodle ON" : "Doodle OFF";
 	
 	//NEED EXTRA CODE HERE TO EITHER TURN OFF HIGHLIGHT
 	//OR CHANGE IS SPLIT CODE
 	//LETS TURN OFF HIGHLIGHTER
 	clear_highlight();
 	highlightNum = 0;
 	
 	
 }
 
 function alerter(alert_String) {
 	var ell = a_cell = document.getElementById("alerter");
 	ell.innerHTML = alert_String;
 	
 }
 
 function loadPuzzle() {
 	//split thePuzzle into an array
 	var thePuzzleArr = thePuzzle.split("");
 	
 	for (i = 0; i < 81; i++) {
 		
 		var use_cell = document.getElementById((i+1).toString());
 		
 		if (thePuzzleArr[i] != "0") {
 			var theNum = parseInt(thePuzzleArr[i]);
 			use_cell.innerHTML = theNum; 
 			use_cell.className = "black";
 			myBigArray[i+1][0] = makeIntBin(theNum);
 			myBigArray[i+1][1] = 2
 			}
 		
 	
 	}
 
 }
 
 function loadPuzzleChoices() {
 //first loadPuzzleChoices from cookie into myBigArray
 	pCookieArray = puzzleCookie.split(",");
 	//alert(pCookieArray);
 	
 	for (i12 = 0; i12 < 82; i12++) {
 		myBigArray[i12][0] = parseInt(pCookieArray[i12*2]);
 		myBigArray[i12][1] = parseInt(pCookieArray[i12*2 + 1]);
 	
 	}
 	
 	//alert(myBigArray);
 	for (i = 1; i < 82; i++) {
 		//only load if their in addition to original puzzle ie 
 		//second parameter less than 2
 		if (myBigArray[i][1] == 1) {
 			var use_cell = document.getElementById((i).toString());
 			var intNum = BintoInt(myBigArray[i][0]);
 			use_cell.innerHTML = intNum;
 			
 		} else if ((myBigArray[i][1] == 0) && (myBigArray[i][0] != 0)) {
 			//now we have to mimic what we did when splitting cell for
 			//the first time
 			var chosen_cell = document.getElementById(i.toString());
 						
 			chosen_cell.innerHTML = newNineSq;
 			
 			chosen_cell = chosen_cell.childNodes[0];
 			chosen_cell = chosen_cell.childNodes[0];
 			
 			//make an array of the binary number
 			var binArray = BintoString(myBigArray[i][0]); 
 			
 			for (ii = 0; ii < 9; ii++) {
 				if (binArray[ii] != " ") {
 					//alert(binArray[ii]);
 					var tinyChoice = parseInt(binArray[ii]);
 					//alert((tinyChoice - 1)%3);
 					chosen_cell = chosen_cell.childNodes[parseInt((tinyChoice - 1)/3)];
 					chosen_cell = chosen_cell.childNodes[(tinyChoice - 1)%3];
 					chosen_cell.className = "tiny";
 					chosen_cell = chosen_cell.parentNode;
 					chosen_cell = chosen_cell.parentNode;
 					
 				}
 			}
 			
 			
 			
 						
 		}				
 		
 	}
 	

 	
 	find_errors();
 	
 	
 	
 }
 
 
 function closing_sequence() {
 	
 	
 	var incrementer = 0;
 	var pick_square = setInterval(colour_square, 40);
 	
 	
 	
 	
 	
 	
 	/*var countyy = 0;
 	for (i7 = 0; i7 < aGridSpiral.length; i7++) {
 		next_square = aGridSpiral[i7];
 		setTimeout(colour_square, 10);
 		countyy = countyy + 1;
 	}*/
 
	function colour_square() {
		if (incrementer < aGridSpiral.length + 5) {
			var classCol = "";
			for (i6 = 0; i6 < 5; i6++) {
			
			switch(i6) {
				case 0:
					classCol = "blackHighlight";
					break;
				case 1: 
					classCol = "grayHighlight";
					break;
				case 2:
					classCol = "darkGrayHighlight";
					break;
				case 3:
					classCol = "lightGrayHighlight";
					break;
				default:
					classCol = "";
			}
			
			var next_square = aGridSpiral[incrementer - i6];
			if (((incrementer - i6) > -1) && ((incrementer - i6) <= 80)) {
				var spiral_cell = document.getElementById(next_square.toString());
				var changeCName = spiral_cell.className.toString();
				
				changeCName = changeCName.replace(" blackHighlight", "");
				changeCName = changeCName.replace(" grayHighlight", "");
				changeCName = changeCName.replace(" darkGrayHighlight", "");
				changeCName = changeCName.replace(" lightGrayHighlight", "");
				spiral_cell.className = changeCName;
				
				//if (classCol != "") {
					spiral_cell.className = spiral_cell.className + " " + classCol;
				//} else {
				//	spiral_cell.className = spiral_cell.className;
				//}
				
				
				
				}
			
			
			}
			
			
			} else {
			myStopFunction();
			}
		incrementer++;	
		
		
			
	}
	 	
 	
 	function myStopFunction() {
  		clearInterval(pick_square);
  		
  		alert("Complete. Well done!");
  		for (i8 = 1; i8 < 82; i8++) {
			shout_cell = document.getElementById(i8.toString());
			shout_cell.className = shout_cell.className.replace("black", "");
			shout_cell.className = shout_cell.className + " shoutRed";
			
			
		
		}
  		
  		
	}

 setCookie(puzzleID, "", 0)
 
 }
 
 
 //the beginning of any function to respond to these listeners should be
 //as follows. Notice the implied parameter e, even though there
 //is no such thing in the function call in the addEventListener
 //I guess e just refers to the element
 
 function hi_cell(e) {
 	var el;
 	if (window.event && window.event.srcElement) el = window.event.srcElement;
 	if (e && e.target) el = e.target;
 	if (!el) return;
 	
 	//then do something with that element
 	//or ascendDOM to do something with a higher element
 	
 	//In the example given, el = ascendDOM(el, 'td'); shouldn't be any ascent 
 	//at all, since it was 'td' that had the listeners attached
 	//then it ascends to 'tr'
 	
 	
 	}
 	
 	
 	//Program fires when one of 81 cells is tapped
 	//try making this just a function for change state
 	
 	/* ########
 	function cell_tap(e) {
 		
 		var el;
 		if (window.event && window.event.srcElement) {
 			//alert("im src element");
 			el = window.event.srcElement;
 			//alert(el.id);
 			
 			
 			
 			//This allows me to ascend when there is a parent
 			//and not when there isn't
 			//cag = ascendDOM(el.parentNode, "table");
 			//cag = ascendDOM(el.parentNode, "td");
 			//alert(cag.childNodes[0].id);
 			//cag.removeChild(cag.childNodes[0]);
 			///cag.innerHTML = "GEF";
 			//
 			
 			//i'll turn preceding knowledge into a toggle
 			
 			
 			cag = ascendDOM(el.parentNode, "table");
 			
 			if (ascendDOM(el.parentNode, "td")) {
 				cag = ascendDOM(el.parentNode, "td");
 				//alert(cag.childNodes[0].id);
 				if (cag.childNodes[0].id == "tableToGo") {
 					
 					cag.removeChild(cag.childNodes[0]);
 					cag.innerHTML = cag.id;
 					
 				} 
 			} else {
 				//alert(el.id);
 				var newNineSq = "<table id='tableToGo' width=100% height=100%><tr align='center'><td class='tiny'>1</td><td class='tiny'>2</td><td class='tiny'>3</td></tr>"
 				newNineSq = newNineSq + "<tr align='center'><td class='tiny2'>4</td><td class='tiny'>5</td><td class='tiny'>6</td></tr>"
 				newNineSq = newNineSq + "<tr align='center'><td class='tiny'>7</td><td class='tiny2'>8</td><td class='tiny'>9</td></tr></table>"
 				el.innerHTML = newNineSq;
 			}
 			
 			
 			
 			
 			//bob = window.event.srcElement.parentNode;
 			//bob = bob.parentNode;
 			//bob = bob.parentNode;
 			//bob = bob.parentNode.tagName;
 			//alert(bob);
 			
 		} else if (e && e.target) {
 			alert("This will not work on your browser");
 			el = e.target;
 		} else if (!el) {
 			alert("To operated you must activate Javascript");
 		} 
 		
 		
 		
 		
 		
 		//alert("dont worty");
 
 		
 	}
 	
 	*/
 	
 	function cell_tap(e) {
 	
 	
 	cell_hightlight(e);
 			
 	
 	}
 	
 	
 	function cell_hightlight(e) {
 	
 	
 	var el;
 		if (window.event && window.event.srcElement) {
 			//alert("im src element");
 			el = window.event.srcElement;
 			
 			
 			
 			/*cag = ascendDOM(el.parentNode, "table");
 			
 			if (ascendDOM(el.parentNode, "td")) {
 				cag = ascendDOM(el.parentNode, "td");
 				//alert(cag.childNodes[0].id);
 				if (cag.childNodes[0].id == "tableToGo") {
 					
 					cag.removeChild(cag.childNodes[0]);
 					cag.innerHTML = cag.id;
 					
 				} */
 			
 			
 			//HERE'S A KEY ISSUE ABOUT LEAVING A HIGHLIGHTED
 			//SQUARE AFTER SWITCHING THE SPLIT
 			
 			if (ascendDOM(el.parentNode, "td")) {
 				var cag = ascendDOM(el.parentNode, "td");
 				//alert(cag.childNodes[0].id);
 				if (cag.childNodes[0].id == "tableToGo") {
 			
				//YOU GET HERE WHEN A HIGHLIGHTED
				//SQUARE IS SPLIT INTO SMALLS
				//WE'LL NEED A MARKER isSplit TO
				//DRAW ATTENTION TO THIS
				isSplit = true;
				//alert("isSplit true");
				el = cag;
				
				 				
 				} 
 				 
 			} else {
 				//alert(el.id);
 				
 				//alert("not split")
 				isSplit = false;
 				//alert("isSplit false");
 							
 			}
 			
 			//abort here if its a puzzle number
 			if (myBigArray[el.id][1] == 2) {return;}
 			
 			
 			//same happens to highlighting whatever
 			clear_highlight();
 			if (el.className == "pinkHighlight") {
 				el.className = "plumHighlight";
 			
 			} else {	
 				el.className="blueHighlight";
 			}
 			
  			highlightNum = parseInt(el.id);  
			
 		}
 	}
 	
 	
 	//Simple change the number
 	//Now to isolate everything but false false
 	function num_tap(e) {
 		
 		var el;
 			if (window.event && window.event.srcElement) {
 				
 				
 				 
 				el = window.event.srcElement;
 				
 				var cag = ascendDOM(el.parentNode, "td");
 				
 						clear_nums();
 				
 						cag.className = "blueHighlight";
 				
 				
 						touchNum = parseInt(cag.id) - 100;
 				
 				//this what you do if isSplit is false AND Doodle is OFF
 				
 				if (isSplit == false) {
 					if (doodleSwitch == false) {
 						
 						//alerter("Split off, Switch off");
 						//alerter(highlightNum);
 						
 				
 						if (highlightNum != 0) {
 				
 				   			chosen_cell = document.getElementById(highlightNum.toString());
 				   
 				   			var fill = chosen_cell.innerHTML != touchNum.toString() ? touchNum.toString() : "";
 				   			chosen_cell.innerHTML = fill;
 				   			
 				   			//replace what ever is in array with InttoBin and 1
 				   			
 				   			//Noooooooo, need an if 
 				   			//Need to replicate the above
 				   			if (makeIntBin(touchNum) != myBigArray[highlightNum][0]) {
 				   				myBigArray[highlightNum][0] = makeIntBin(touchNum);
 				   				myBigArray[highlightNum][1] = 1;
 				   				
 				   				} else {
 				   				myBigArray[highlightNum][0] = 0;
 				   				myBigArray[highlightNum][1] = 0;
 				   				
 				   				}

 				   			
 							
 							}
 							
 						} else if (doodleSwitch == true) {
 						//ie if doodleSwitch is true when there's no split
 						//we have to create a split
 						//alert("we have a split situation");
 						//alerter("Split off, switch on");
 						
 						chosen_cell = document.getElementById(highlightNum.toString());
 						
 						chosen_cell.innerHTML = newNineSq;
 						
 						
 						//now to get to the child nodes
 						chosen_cell = chosen_cell.childNodes[0];
 						chosen_cell = chosen_cell.childNodes[0];
 						chosen_cell = chosen_cell.childNodes[parseInt((touchNum - 1)/3)];
 						chosen_cell = chosen_cell.childNodes[(touchNum - 1)%3];
 						chosen_cell.className = "tiny";
 						
 						//Do the same as above but a 0 says it's not a doodle choice
 						myBigArray[highlightNum][0] = makeIntBin(touchNum);
 				   			myBigArray[highlightNum][1] = 0;
 						
 						
 						clear_nums;
 						isSplit = true;
 						
 						} else {
 							alerter("false split leak");
 						}
 						
 						
 					} else if (isSplit == true){
 					
 					//if the doodleSwitch is false this works
 						if (doodleSwitch == false) {	
 							//alerter("split on, switch off");
 							
 							
 							
 				
 							if (highlightNum != 0) {
 				
 				   				var chosen_cell = document.getElementById(highlightNum.toString());
 				   
 				   				var fill = chosen_cell.innerHTML != touchNum.toString() ? touchNum.toString() : "";
 				   				chosen_cell.innerHTML = fill;
 				   				
 				   				//same as for first fill just overwriting
 				   				myBigArray[highlightNum][0] = makeIntBin(touchNum);
 				   				myBigArray[highlightNum][1] = 1;
 				   				
 				   				//HERE'S THE PROBLEM
 				   				//must insert the command below
 				   				isSplit = false;
 					
 							}
 						} else if (doodleSwitch == true) {
 						
 							//alerter("split on, switch on");
 							//need to do something clever
 							
 							chosen_cell = document.getElementById(highlightNum.toString());
 						
 						//Don't need to add units
 						//chosen_cell.innerHTML = newNineSq;
 						
 						
 						//now to get to the child nodes
 						chosen_cell = chosen_cell.childNodes[0];
 						chosen_cell = chosen_cell.childNodes[0];
 						chosen_cell = chosen_cell.childNodes[parseInt((touchNum - 1)/3)];
 						chosen_cell = chosen_cell.childNodes[(touchNum - 1)%3];
 						
 						var touchBin = makeIntBin(touchNum);
 						if (chosen_cell.className == "tiny2") {
 							//add
 							
 							myBigArray[highlightNum][0] = myBigArray[highlightNum][0] + touchBin; 
 							myBigArray[highlightNum][1] = 0;
 						} else {
 							myBigArray[highlightNum][0] = myBigArray[highlightNum][0] - touchBin; 
 							myBigArray[highlightNum][1] = 0;
 						}
 						
 						
 						chosen_cell.className = chosen_cell.className != "tiny" ? "tiny" : "tiny2";
 						
 						
 						//a bit cleverer, we have to add or subtract
 						//we could do it via the tinys above 
 							
 							
 						
 						} else {
 							//alerter("true split leak");
 						}
 						
 						
 					
 					} else {
 						//alerter("leak here");
 					}
 						
 									
 				} 
 					
 					
 		find_errors();			
		
		//AN ANOMOLY HERE?
		//alerter(makeIntBin(touchNum));
		//set the cookie here"
		setCookie(puzzleID, myBigArray, 14);
 		//alerter(myBigArray);	
 				

 	}
 		
 	function clear_nums() {
 	//clears current touchNum and highlight
 		if (touchNum != 0) {
 			
 			cellId = touchNum+100;
 			choose_cell = document.getElementById(cellId.toString());
 			choose_cell.className = "";
 			
 			}

 	}
 	
 	function clear_highlight() {
 	
		//alert("got here"); 	
 		if (highlightNum != 0) {
 			cellId = highlightNum;
 			choose_cell = document.getElementById(cellId.toString());
 			if (choose_cell.className.indexOf("blueHighlight") > -1) {
 				//choose_cell.className = "";
 				choose_cell.className = choose_cell.className.replace("blueHighlight","");
 				} else if (choose_cell.className.indexOf("plumHighlight") > -1) {
 				choose_cell.className = choose_cell.className.replace("plumHighlight","pinkHighlight"); 
 				}
 		
 		}
 	
 	}	
 	
 	
 	//I'll split into find errors and show errors. 
 	function find_errors() {
 		//for each gridArray compile numbers with && for the 1s and 2s
 		//ie firm choices and puzzle numbers
 		//return a string 
 		allFilled = true;
 		var errorsArray = [99];
 		var pickedNums = 0;
 		var repeatNums = 0;
 		
 		//going up to 36 allows us to do the other grid array
 		for (ii = 0; ii < 36; ii++) {
 		pickedNums = 0;
 		repeatNums = 0;
 		
 		for (i = 0; i < 9; i++) {
 			
 			if (ii < 27) {
 				if (myBigArray[aGridArray[ii][i]][1] > 0) {
 				//do this in two parts
 				//if ii is > 26 we go in to the other grid array aGrid3D
 				
 				
 					repeatNums = (pickedNums & myBigArray[aGridArray[ii][i]][0]) | repeatNums; 
 				
 					pickedNums = pickedNums | myBigArray[aGridArray[ii][i]][0]; 
 				 	
 				
 				} else {
 				allFilled = false;
 				}	
 			} else  {
 				if (myBigArray[aGrid3D[ii - 27][i]][1] > 0) {
 				//do this in two parts
 				//if ii is > 26 we go in to the other grid array aGrid3D
 				
 				
 					repeatNums = (pickedNums & myBigArray[aGrid3D[ii - 27][i]][0]) | repeatNums; 
 				
 					pickedNums = pickedNums | myBigArray[aGrid3D[ii - 27][i]][0]; 
 				 	
 				
 				} else {
 				allFilled = false;
 				}	
 			}
 			
  				
 			
 		}
 		for (i = 0; i < 9; i++) {
 			//second pass gives adds locations of offending numbers
 			//again for Max we do in two parts
 			if (ii < 27) {
 			
 				if (myBigArray[aGridArray[ii][i]][1] > 0) {
 					if ((repeatNums & myBigArray[aGridArray[ii][i]][0]) > 0) {
 					
 					
 						errorsArray.push(aGridArray[ii][i]);
 				
 					}
 				
 				//errorsArray.push(myBigArray[aGridArray[0][i]][0]);
 				}
 			} else {
 			
 				if (myBigArray[aGrid3D[ii - 27][i]][1] > 0) {
 					if ((repeatNums & myBigArray[aGrid3D[ii - 27][i]][0]) > 0) {
 					
 					
 						errorsArray.push(aGrid3D[ii - 27][i]);
 				
 					}
 				
 				//errorsArray.push(myBigArray[aGridArray[0][i]][0]);
 				}
 			
 			}
 			
 			
 		
 		}
 		
 		}
 		
 		//a bid daft as errors.Array will always be greater
 		//and whatever happens you have to turn off the pinks
 		if (errorsArray.length > 0) {
 		
 			show_errors(errorsArray);
 		}
 		
 		/*if (allFilled == true) {
 		   alert("we're full");
 		}*/
 		
 	} 
 	
 	function show_errors(errorsArr) {
 		//go through turned pink to turn off previous pinks
 		
 		if (turnedPink.length > 0) {
 		for (iii = 1; iii < turnedPink.length; iii++) {
 			var pink_el = document.getElementById(turnedPink[iii].toString());
 			//shouldn't have plum on a puzzle number
 			if (pink_el.className.indexOf("plumHighlight") > -1) {
 				pink_el.className = pink_el.className.replace("plumHighlight","blueHighlight");
 				} else {
 				//should be able to keep black by adding className
 				pink_el.className = pink_el.className.replace("pinkHighlight","");
 				pink_el.className = pink_el.className.replace(" ","");
 				
 				}
 			  
 		}
 		}
 		
 		turnedPink = errorsArr;
 		
 		//var toPinkSquares;
 		if (errorsArr.length > 0) {
 		
 		for (iii = 1; iii < errorsArr.length; iii++) {
 			
 			
 			var to_pink_el = document.getElementById(errorsArr[iii].toString());
 			
 			if (to_pink_el.className.indexOf("blueHighlight") > -1) {
 			to_pink_el.className = to_pink_el.className.replace("blueHighlight","plumHighlight"); 
 			} else {
 			
 			//to_pink_el.className = "pinkHighlight" + " " + to_pink_el.className; 
 			
 			
 			 if (to_pink_el.className == "") {
 			  to_pink_el.className = "pinkHighlight";
 			  } else {
 			  to_pink_el.className = to_pink_el.className + " pinkHighlight";
 			  }
 			}
 		}
 		}
 		
 		if ((turnedPink.length < 2) && (allFilled == true)) {
 		//alert("You've done it");
 		closing_sequence();
 		} 
 		
 	}
 	
 	//FROM HERE WE'LL DO THE COOKIES
	
 function setCookie(cname, cvalue, exdays) {
  var d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  var expires = "expires="+d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

//we'll changed user/username to puzzNo and puzzleNo 
function checkCookie() {
  //This checks whether the ID is the correct one
  //In theory you could have several different puzzles on the go
  var puzzNo = getCookie(puzzleID);
  //alert(puzzNo);
  	if (puzzNo != "") {
    	
    	puzzleStarted = true;
    
  	} else {
  	//Nothing needs to be done 
  	//merely sets cookie 
  	//when entries are made
  	//good to set up a flag like puzzleStarted
    puzzleStarted = false;
    }
    
    return puzzNo;
  }

 	
 
 	
 	
 	
 	
 		
 	
 	addEvent(window, 'load', addListeners, false);
 	
 	
	</script>

<style>table.outer {border-style: solid; border-color: black; border:
5px solid black; border-collapse: collapse} td {font: 46px arial,
sans-serif; color: blue; text-align: center; border: 1px solid black}
#small {font: 12px arial} td.black {color: black} td.tiny {font: 14.5px arial; transform:
scaleX(1.5) scaleY(1); transform-origin: -1 -1; color: blue; padding:
0px; margin: 0px; border: 0px transparent} td.tiny2 {font: 14.5px arial;
transform: scaleX(1.5) scaleY(1); transform-origin: -1 -1; color:
transparent; padding: 0px; margin: 0px; border: 0px transparent}
.blueHighlight {background: lightblue} .pinkHighlight {background:
lightpink} .plumHighlight {background: plum} .tilted {font: 20px arial; color: black;
transform: rotate(-10deg); margin: 3px} table.floater {position: relative; z-index: 1; border-style: transparent; left: 0px; top: 0px}
.blackHighlight {background: Black} .darkGrayHighlight {background: DarkGray} .lightGrayHighlight {background: LightGray} .grayHighlight {background: Gray} .shoutRed {color: Red}

</style>


	</head>
	<body>
		<h1 style="font-family:verdana-bold">Sudoku Max 6 December</h1>
		
		<table width=600px style="border-style: transparent"><tr><td style="font: 16px verdana; color: black; text-align: left; border: 0px; border-style: transparent">
		Max is the same as conventional sudoku with one extra rule. Complete the grid with every number from 1 to 9 in each row, column and
3x3 square. Also, if the 3x3 squares are stacked, each imaginary column must contain the numbers 1 to 9. See beneath puzzle for instructions. If the grid is empty,
Javascript needs to be enabled. <p></p>

		
		</td><tr></table>

		<table class=outer width=600px height=600px>
			<tr>
				<td id='1' align="center" width=10.9% height=10.9%></td>
				<td id='2' align="center" width=10.9% height=10.9%></td>
				<td id='3' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='4' align="center" width=10.9% height=10.9%></td>
				<td id='5' align="center" width=10.9% height=10.9%></td>
				<td id='6' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='7' align="center" width=10.9% height=10.9%></td>
				<td id='8' align="center" width=10.9% height=10.9%></td>
				<td id='9' align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='10' align="center" width=10.9% height=10.9%></td>
				<td id='11' align="center" width=10.9% height=10.9%></td>
				<td id='12' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='13' align="center" width=10.9% height=10.9%></td>
				<td id='14' align="center" width=10.9% height=10.9%></td>
				<td id='15' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='16' align="center" width=10.9% height=10.9%></td>
				<td id='17' align="center" width=10.9% height=10.9%></td>
				<td id='18' align="center" width=10.9% height=10.9%></td>
				
			</tr>
			<tr>
				<td id='19' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='20' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='21' style="border-right: solid black 4px; border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='22' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='23' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='24' style="border-right: solid black 4px; border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='25' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='26' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='27' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='28' align="center" width=10.9% height=10.9%></td>
				<td id='29' align="center" width=10.9% height=10.9%></td>
				<td id='30' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='31' align="center" width=10.9% height=10.9%></td>
				<td id='32' align="center" width=10.9% height=10.9%></td>
				<td id='33' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='34' align="center" width=10.9% height=10.9%></td>
				<td id='35' align="center" width=10.9% height=10.9%></td>
				<td id='36' align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='37' align="center" width=10.9% height=10.9%></td>
				<td id='38' align="center" width=10.9% height=10.9%></td>
				<td id='39' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='40' align="center" width=10.9% height=10.9%></td>
				<td id='41' align="center" width=10.9% height=10.9%></td>
				<td id='42' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='43' align="center" width=10.9% height=10.9%></td>
				<td id='44' align="center" width=10.9% height=10.9%></td>
				<td id='45' align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='46' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='47' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='48' style="border-right: solid black 4px; border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='49' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='50' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='51' style="border-right: solid black 4px; border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='52' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='53' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='54' style="border-bottom: solid black 4px" align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='55' align="center" width=10.9% height=10.9%></td>
				<td id='56' align="center" width=10.9% height=10.9%></td>
				<td id='57' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='58' align="center" width=10.9% height=10.9%></td>
				<td id='59' align="center" width=10.9% height=10.9%></td>
				<td id='60' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='61' align="center" width=10.9% height=10.9%></td>
				<td id='62' align="center" width=10.9% height=10.9%></td>
				<td id='63' align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='64' align="center" width=10.9% height=10.9%></td>
				<td id='65' align="center" width=10.9% height=10.9%></td>
				<td id='66' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='67' align="center" width=10.9% height=10.9%></td>
				<td id='68' align="center" width=10.9% height=10.9%></td>
				<td id='69' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='70' align="center" width=10.9% height=10.9%></td>
				<td id='71' align="center" width=10.9% height=10.9%></td>
				<td id='72' align="center" width=10.9% height=10.9%></td>
			</tr>
			<tr>
				<td id='73' align="center" width=10.9% height=10.9%></td>
				<td id='74' align="center" width=10.9% height=10.9%></td>
				<td id='75' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='76' align="center" width=10.9% height=10.9%></td>
				<td id='77' align="center" width=10.9% height=10.9%></td>
				<td id='78' style="border-right: solid black 4px" align="center" width=10.9% height=10.9%></td>
				<td id='79' align="center" width=10.9% height=10.9%></td>
				<td id='80' align="center" width=10.9% height=10.9%></td>
				<td id='81' align="center" width=10.9% height=10.9%></td>
			</tr>
		</table>
		<p id='alerter'></p>
		<table class=outer width=600px height=66px border=solid align-content=center>
			<tr>
				<td id='101' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">1</td></tr></table></font></td>
				<td id='102' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">2</td></tr></table></font></td>
				<td id='103' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">3</td></tr></table></font></td>
				<td id='104' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">4</td></tr></table></font></td>
				<td id='105' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">5</td></tr></table></font></td>
				<td id='106' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">6</td></tr></table></font></td>
				<td id='107' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">7</td></tr></table></font></td>
				<td id='108' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">8</td></tr></table></font></td>
				<td id='109' align="center" width=9.5% height=100%><font color="blue"><table class="floater" height=100% width=100%><tr><td style="border: transparent">9</td></tr></table></font></td>
				<td id='doodle' align="center" width=14.5% height=100% class='tilted'><font color="black">Doodle OFF</font></td>
			</tr>
			
			</table>
			
			<br>
			<table width=600px style="border-style: transparent"><tr><td style="font: 16px verdana; color: black; text-align: left; border: 0px; border-style: transparent">
		<p><b>INSTRUCTIONS</b></p>
<p></p>
Tap/click a square to highlight it, then tap a choice from the number
panel above. Entering a number twice clears it. Doodle
function enables the entry of several tiny numbers in one
square if that helps. Pink highlights indicate a foul move. A cookie saves working on a single device.
<p></p>

</td><tr></table>
	</body>
</html>

			